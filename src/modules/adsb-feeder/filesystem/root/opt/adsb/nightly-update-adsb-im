#!/bin/bash

cd /opt/adsb
TIME=$(date -Iseconds)

# check in the .env file what we should do
if grep "^_ADSBIM_STATE_IS_NIGHTLY_BASE_UPDATE_ENABLED=True" config/.env ; then
	apt update >> /var/log/adsb-setup.log 2>&1
	apt upgrade -y >> /var/log/adsb-setup.log 2>&1
fi
if grep "^_ADSBIM_STATE_IS_NIGHTLY_FEEDER_UPDATE_ENABLED=True" config/.env ; then
	bash /opt/adsb/feeder-update
elif grep "^_ADSBIM_STATE_IS_NIGHTLY_CONTAINER_UPDATE_ENABLED=True" config/.env ; then
	# the feeder update above includes the container update, so let's not do it twice in a row
	bash /opt/adsb/docker-update-adsb-im
fi
