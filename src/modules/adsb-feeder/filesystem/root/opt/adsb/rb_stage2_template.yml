volumes:
  radarbox_segfault_fix:
    driver: local
    driver_opts:
      type: none
      device: /opt/adsb/rb
      o: bind

services:
  rbfeeder_STAGE2NUM:
    image: ${RB_CONTAINER}
    healthcheck:
      disable: true
    tty: true
    container_name: rbfeeder_STAGE2NUM
    restart: always
    cpu_period: 50000
    cpu_quota: 7500
    environment:
      - BEASTHOST=ultrafeeder_STAGE2NUM
      - UAT_RECEIVER_HOST=${FEEDER_RB_UAT978_HOST_STAGE2NUM:-}
      - LAT=${FEEDER_LAT_STAGE2NUM}
      - LONG=${FEEDER_LONG_STAGE2NUM}
      - ALT=${FEEDER_ALT_M_STAGE2NUM}
      - TZ=${FEEDER_TZ_STAGE2NUM}
      - SHARING_KEY=${FEEDER_RADARBOX_SHARING_KEY_STAGE2NUM}
      - S6_KILL_GRACETIME=1000
      - MLAT_RESULTS_BEASTHOST=ultrafeeder_STAGE2NUM
      # USER_PROVIDED_ENV_START
      # USER_PROVIDED_ENV_END
    tmpfs:
      - /run:exec,size=64M
      - /var/log
    volumes:
      - radarbox_segfault_fix:${FEEDER_RB_THERMAL_HACK:-/tmp/rbt}:ro
      - /opt/adsb/rb/cpuinfo:/proc/cpuinfo:ro
